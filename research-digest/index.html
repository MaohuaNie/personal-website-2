<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Research Digest | Maohua Nie</title>
  <meta name="description" content="Archive of automated research digests" />
  <link rel="stylesheet" href="/assets/site.css" />
  <link rel="icon" href="/favicon.svg" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
    }

    /* ===== Layout ===== */
    .digest-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      height: 100vh;
      background: #ffffff;
    }

    /* ===== Sidebar ===== */
    .digest-sidebar {
      height: 100vh;
      overflow-y: auto;
      padding: 18px 16px;
      background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
      border-right: 1px solid #e5e7eb;
      -webkit-overflow-scrolling: touch;
    }

    .digest-sidebar::-webkit-scrollbar {
      width: 8px;
    }
    .digest-sidebar::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.15);
      border-radius: 6px;
    }

    /* ===== Header ===== */
    .digest-header {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 16px;
    }

    .digest-header h1 {
      font-size: 22px;
      margin: 0;
      font-weight: 700;
      color: #111827;
    }

    .digest-header p {
      margin: 0;
      font-size: 13px;
      color: #6b7280;
      line-height: 1.4;
    }

    .digest-divider {
      height: 1px;
      background: linear-gradient(to right, #e5e7eb, transparent);
      margin: 14px 0 18px;
    }

    /* ===== Back to Home ===== */
    .home-button {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 14px;
      font-size: 17px;
      font-weight: 600;
      border-radius: 14px;
      text-decoration: none;
      color: #ffffff;
      background: linear-gradient(
        135deg,
        rgba(7, 69, 135, 0.95),
        rgba(0, 75, 122, 0.95)
      );
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
    }

    /* ===== Navigation ===== */
    .digest-nav {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .digest-year {
      margin: 20px 0 8px;
      padding-left: 6px;
      font-size: 16px;
      font-weight: 700;
      color: #111827;
      pointer-events: none;
      user-select: none;
    }

    .digest-nav li {
      margin: 8px 0;
    }

    .digest-link {
      display: block;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      color: #111827;
      cursor: pointer;
      text-decoration: none;
      transition: all .15s ease;
    }

    .digest-link:hover {
      background: #f9fafb;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }

    .digest-link.active {
      background: #eef2ff;
      border-left: 4px solid #1e3a8a;
      padding-left: 10px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    }

    .digest-title {
      font-size: 14px;
      font-weight: 600;
    }

    /* ===== Main Content ===== */
    .digest-content {
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ===== About Box ===== */
    .about-box {
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      padding: 14px 22px;
    }

    .about-toggle {
      font-size: 14px;
      font-weight: 600;
      color: #1e3a8a;
      cursor: pointer;
      user-select: none;
    }

    .about-content {
      margin-top: 12px;
      font-size: 13px;
      line-height: 1.55;
      color: #374151;
      display: none;
    }
    .about-content.visible {
      display: block;
    }

    .about-content p {
      margin: 8px 0;
    }

    /* ===== Iframe ===== */
    #digest-frame {
      flex: 1;
      width: 100%;
      border: none;
    }

    iframe {
      background: #f6f7fb;
    }

    /* ===== Mobile ===== */
    @media (max-width: 900px) {
      .digest-layout {
        grid-template-columns: 1fr;
      }

      .digest-sidebar {
        max-height: 45vh;
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
      }

      .digest-content {
        height: calc(100vh - 45vh);
      }
    }
  </style>
</head>

<body>
  <div class="digest-layout">

    <!-- ===== Sidebar ===== -->
    <aside class="digest-sidebar">
      <div class="digest-header">
        <a href="/" class="home-button">← Back to Home</a>
        <h1>Research Digest</h1>
        <p>Bi-weekly digests (1st &amp; 15th)</p>
      </div>

      <div class="digest-divider"></div>

      <ul id="digest-nav" class="digest-nav">
        <li>Loading…</li>
      </ul>
    </aside>

    <!-- ===== Main ===== -->
    <main class="digest-content">

      <!-- About -->
      <div class="about-box">
        <div class="about-toggle" onclick="toggleAbout()">
          ℹ️ About this digest
        </div>
      <div id="about-content" class="about-content">
        <p>
          This bi-weekly research digest is generated automatically from selected journals in psychology, decision science, and behavioral economics and is maintained primarily for my own literature monitoring.
          Publication metadata are retrieved primarily via the
          <strong>Crossref</strong> API, with abstracts collected using a prioritized
          fallback strategy that includes publisher APIs (e.g., <strong>Elsevier</strong>),
          <strong>OpenAlex</strong>, and <strong>Semantic Scholar</strong>.
        </p>

        <p>
          Papers are ranked by semantic similarity to predefined research topics using
          vector embeddings generated with the <strong>OpenAI API</strong>, and a
          large language model is used to assess topical relevance and generate brief,
          plain-language summaries. The final digest reflects a combination of
          automated retrieval, semantic ranking, and model-based filtering.
        </p>

        <p>
          <strong>Disclaimer.</strong> All articles, abstracts, and bibliographic
          metadata remain the property of their respective authors and publishers.
          Summaries and relevance scores are generated automatically and may be
          imperfect or incomplete. This digest is intended as a research aid rather
          than an authoritative or exhaustive source; readers should consult the
          original publications for definitive information.
        </p>
      </div>
      </div>

      <!-- Viewer -->
      <iframe id="digest-frame" title="Digest Viewer"></iframe>
    </main>
  </div>

  <script>
    function toggleAbout() {
      document
        .getElementById("about-content")
        .classList.toggle("visible");
    }

    function setActive(linkEl) {
      document.querySelectorAll(".digest-link")
        .forEach(a => a.classList.remove("active"));
      linkEl.classList.add("active");
    }

    function formatDigestTitle(dateStr) {
      const d = new Date(dateStr + "T00:00:00");
      const month = d.toLocaleString("en-US", { month: "short" });
      const day = d.getDate();

      if (day === 15) return `Early ${month}`;
      if (day === 1) {
        const prev = new Date(d);
        prev.setDate(0);
        return `Late ${prev.toLocaleString("en-US",{month:"short"})}`;
      }
      return dateStr;
    }

    fetch("digests.json")
      .then(r => r.json())
      .then(digests => {
        const nav = document.getElementById("digest-nav");
        const frame = document.getElementById("digest-frame");
        nav.innerHTML = "";

        const ordered = digests
          .slice()
          .sort((a, b) => new Date(b.date) - new Date(a.date));

        let lastYear = null;

        ordered.forEach((d, i) => {
          const year = new Date(d.date + "T00:00:00").getFullYear();

          if (year !== lastYear) {
            const y = document.createElement("li");
            y.className = "digest-year";
            y.textContent = year;
            nav.appendChild(y);
            lastYear = year;
          }

          const li = document.createElement("li");
          const a = document.createElement("a");
          a.className = "digest-link";
          a.innerHTML = `<div class="digest-title">${formatDigestTitle(d.date)}</div>`;

          a.onclick = e => {
            e.preventDefault();
            frame.src = d.file;
            setActive(a);
          };

          li.appendChild(a);
          nav.appendChild(li);

          if (i === 0) {
            frame.src = d.file;
            setActive(a);
          }
        });
      });
  </script>
</body>
</html>